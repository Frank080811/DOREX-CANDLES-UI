<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Order Successful – Luminous Candles</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Inter,Arial;
  background:#faf7f2;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
}

.success-card{
  background:#fff;
  padding:3rem;
  max-width:520px;
  width:100%;
  border-radius:18px;
  text-align:center;
  box-shadow:0 30px 60px rgba(0,0,0,.12);
  animation:fadeUp .8s ease forwards;
}

.checkmark{
  width:88px;
  height:88px;
  border-radius:50%;
  background:#ff7a00;
  color:#fff;
  font-size:3rem;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:0 auto 1.4rem;
  animation:pop .6s ease;
}

h1{margin:.6rem 0}
p{color:#666;font-size:.95rem}

.order-box{
  margin-top:2rem;
  text-align:left;
  font-size:.9rem;
}

.order-line{
  display:flex;
  justify-content:space-between;
  padding:.6rem 0;
  border-bottom:1px dashed #eee;
}

.total{
  font-weight:600;
  color:#ff7a00;
}

.actions{
  margin-top:2rem;
  display:flex;
  gap:1rem;
}

.actions a{
  flex:1;
  padding:.9rem;
  border-radius:6px;
  text-decoration:none;
  text-align:center;
  font-weight:500;
  transition:.3s;
}

.btn-primary{
  background:#ff7a00;
  color:#fff;
}

.btn-primary:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 20px rgba(255,122,0,.4);
}

.btn-outline{
  border:1px solid #ddd;
  color:#111;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(30px)}
  to{opacity:1;transform:translateY(0)}
}

@keyframes pop{
  0%{transform:scale(.6)}
  100%{transform:scale(1)}
}
</style>
</head>

<body>

<div class="success-card">
  <div class="checkmark">✓</div>
  <h1>Payment Successful</h1>
  <p>Thank you for shopping with Luminous Candles.</p>

  <div class="order-box" id="orderBox">
    <div class="order-line"><span>Order ID</span><span id="orderId">—</span></div>
    <div class="order-line"><span>Subtotal</span><span>$<span id="subtotal">0.00</span></span></div>
    <div class="order-line"><span>Tax</span><span>$<span id="tax">0.00</span></span></div>
    <div class="order-line"><span>Shipping</span><span>$<span id="shipping">0.00</span></span></div>
    <div class="order-line total"><span>Total</span><span>$<span id="total">0.00</span></span></div>
  </div>

  <div class="actions">
    <a href="shop.html" class="btn-outline">Continue Shopping</a>
    <a href="index.html" class="btn-primary">Back Home</a>
  </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", async () => {
    
      const params = new URLSearchParams(window.location.search);
      const orderId = params.get("order_id");
    
      if (!orderId) {
        console.warn("No order_id found in URL");
        return;
      }
    
      const orderIdEl = document.getElementById("orderId");
      const subtotalEl = document.getElementById("subtotal");
      const taxEl = document.getElementById("tax");
      const shippingEl = document.getElementById("shipping");
      const totalEl = document.getElementById("total");
    
      if (orderIdEl) {
        orderIdEl.textContent = orderId;
      }
    
      try {
        const res = await fetch(`${API_BASE_URL}/order/${orderId}`);
    
        if (!res.ok) {
          throw new Error("Failed to fetch order");
        }
    
        const data = await res.json();
    
        if (!data.order) {
          throw new Error("Invalid order data");
        }
    
        subtotalEl.textContent = Number(data.order.subtotal).toFixed(2);
        taxEl.textContent = Number(data.order.tax).toFixed(2);
        shippingEl.textContent = Number(data.order.shipping).toFixed(2);
        totalEl.textContent = Number(data.order.total).toFixed(2);
    
        // ✅ Clear cart ONLY after successful confirmation
        localStorage.removeItem("cart");
        localStorage.removeItem("checkoutData");
    
      } catch (err) {
        console.error("Order fetch failed:", err);
    
        // Optional user feedback
        totalEl.textContent = "—";
      }
    });
    </script>
    
<script src="js/config.js"></script>
</body>

</html>
